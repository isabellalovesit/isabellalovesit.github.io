<!DOCTYPE html>
<html>
<head>
  <title>Blocks Chat</title>
  <style>
    body {
      background: radial-gradient(circle, #0b0015, #000);
      color: #d6b3ff;
      font-family: monospace;
      text-align: center;
      padding-top: 30px;
    }

    h1 { text-shadow: 0 0 15px #8f3bff; }

    #chatContainer {
      width: 400px;
      margin: auto;
      background: rgba(0,0,0,0.6);
      border: 2px solid #8f3bff;
      border-radius: 12px;
      box-shadow: 0 0 20px #4b0082;
      padding: 15px;
    }

    #messages {
      height: 250px;
      overflow-y: auto;
      background: rgba(0,0,0,0.4);
      border: 1px solid #4b0082;
      border-radius: 8px;
      padding: 8px;
      text-align: left;
      margin-bottom: 10px;
      font-size: 14px;
    }

    #inputContainer {
      display: flex;
      justify-content: space-between;
    }

    #chatInput {
      width: 75%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #8f3bff;
      background: #111;
      color: #d6b3ff;
    }

    #sendBtn {
      width: 20%;
      border-radius: 8px;
      border: 2px solid #8f3bff;
      background: black;
      color: #d6b3ff;
      cursor: pointer;
      box-shadow: 0 0 10px #6a00ff;
    }

    #sendBtn:hover {
      box-shadow: 0 0 20px #b266ff;
      transform: scale(1.05);
    }

    .system {
      color: #aaa;
      font-style: italic;
    }
  </style>
</head>
<body>

<h1>ðŸŒŒ BLOCKS CHAT ðŸŒŒ</h1>

<div id="chatContainer">
  <div id="messages"></div>
  <div id="inputContainer">
    <input type="text" id="chatInput" placeholder="Type your message...">
    <button id="sendBtn">Send</button>
  </div>
</div>

<button onclick="location.href='index.html'"
  style="position:fixed; top:10px; left:10px;
  padding:10px 20px; font-size:18px;
  border-radius:10px; border:2px solid #8f3bff;
  background:black; color:#d6b3ff;
  box-shadow:0 0 12px #6a00ff; cursor:pointer;">
â¬… Home
</button>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAt2MMZ8ks1NQEOYdHvsTD0wjFpXScUsvc",
    authDomain: "blockschat-multiplayer.firebaseapp.com",
    databaseURL: "https://blockschat-multiplayer-default-rtdb.firebaseio.com",
    projectId: "blockschat-multiplayer",
    storageBucket: "blockschat-multiplayer.firebasestorage.app",
    messagingSenderId: "394182284058",
    appId: "1:394182284058:web:0753a7eeaf078735c212a3",
    measurementId: "G-T1KG35KTPC"
  };

  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  const playerName = prompt("Enter your name:") || "Player";

  const messagesDiv = document.getElementById("messages");
  const chatInput = document.getElementById("chatInput");
  const sendBtn = document.getElementById("sendBtn");

  const chatRef = database.ref("blocksChat");
  const presenceRef = database.ref("presence").push();

  // ðŸŸ¢ JOIN MESSAGE
  chatRef.push({
    system: true,
    text: `ðŸŸ¢ ${playerName} joined the chat`
  });

  presenceRef.set({ name: playerName });
  presenceRef.onDisconnect().remove();

  // ðŸ”´ LEAVE MESSAGE (works on refresh/close)
  window.addEventListener("beforeunload", () => {
    chatRef.push({
      system: true,
      text: `ðŸ”´ ${playerName} left the chat`
    });
  });

  // Send message
  function sendMessage() {
    const text = chatInput.value.trim();
    if (!text) return;

    chatRef.push({
      name: playerName,
      message: text,
      time: new Date().toLocaleTimeString()
    });

    chatInput.value = "";
  }

  // Receive messages
  chatRef.limitToLast(100).on("child_added", snap => {
    const data = snap.val();
    const div = document.createElement("div");

    if (data.system) {
      div.className = "system";
      div.textContent = data.text;
    } else {
      div.textContent = `[${data.time}] ${data.name}: ${data.message}`;
    }

    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });

  sendBtn.addEventListener("click", sendMessage);
  chatInput.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
